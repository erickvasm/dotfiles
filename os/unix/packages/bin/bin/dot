#!/usr/bin/env bash

SCRIPTS_DIR="$HOME/.dotfiles/utilities"

[[ ! -d "$SCRIPTS_DIR" ]] && {
  echo "Directorio no encontrado: $SCRIPTS_DIR"
  exit 1
}

# ---- ejecución directa ----
if [[ $# -gt 0 ]]; then
  SCRIPT="$1"
  shift

  SCRIPT_PATH="$SCRIPTS_DIR/$SCRIPT.sh"

  [[ ! -f "$SCRIPT_PATH" ]] && {
    echo "Script no encontrado: $SCRIPT"
    exit 1
  }

  exec "$SCRIPT_PATH" "$@"
fi

# ---- modo fzf ----

SELECTED=$(ls "$SCRIPTS_DIR"/*.sh \
  | xargs -n1 basename \
  | sed 's/\.sh$//' \
  | fzf \
      --prompt="Selecciona script > " \
      --preview="cat $SCRIPTS_DIR/{}.sh" \
      --preview-window=right:60%)

[[ -z "$SELECTED" ]] && exit 0

SCRIPT_PATH="$SCRIPTS_DIR/$SELECTED.sh"

read -r -p "Parámetros para '$SELECTED': " PARAMS

echo "▶ Ejecutando: $SELECTED $PARAMS"
exec "$SCRIPT_PATH" $PARAMS
